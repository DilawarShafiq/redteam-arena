# CLI Interface Contract: Static Battle Mode

**Feature**: 001-static-battle-mode
**Date**: 2026-02-25

## Commands

### `redteam-arena battle <directory> --scenario <name>`

Start a security battle against the target codebase.

**Arguments**:

| Argument | Type | Required | Description |
|----------|------|----------|-------------|
| directory | string | Yes | Path to the target codebase |

**Options**:

| Option | Type | Required | Default | Description |
|--------|------|----------|---------|-------------|
| --scenario, -s | string | Yes | â€” | Scenario name (e.g., "sql-injection") |
| --rounds, -r | number | No | 5 | Number of battle rounds |

**Exit codes**:

| Code | Meaning |
|------|---------|
| 0 | Battle completed successfully |
| 1 | Battle completed with errors or interrupted |
| 2 | Invalid arguments / missing API key / directory not found |

**Preconditions**:
- `ANTHROPIC_API_KEY` environment variable must be set
- `<directory>` must exist and contain at least one source file
- `<name>` must match a built-in scenario

**Output** (stdout):
- Real-time streamed battle output with color coding
- Battle summary after completion
- Report file path

**Side effects**:
- Creates `redteam-report-<id>.md` in the current working directory

**Error messages**:

| Condition | Message |
|-----------|---------|
| No API key | "Error: ANTHROPIC_API_KEY environment variable is required. Get your key at https://console.anthropic.com/" |
| Invalid directory | "Error: Directory not found: <path>" |
| No source files | "Error: No source files found in <path>" |
| Invalid scenario | "Error: Unknown scenario '<name>'. Available scenarios: sql-injection, xss, auth-bypass, secrets-exposure, full-audit" |
| API auth failure | "Error: Authentication failed. Check your ANTHROPIC_API_KEY." |
| API error mid-battle | "Error: LLM API error during round <N>: <message>. Saving partial report..." |

---

### `redteam-arena list`

List all available built-in scenarios.

**Arguments**: None
**Options**: None

**Exit codes**:

| Code | Meaning |
|------|---------|
| 0 | Success |

**Output** (stdout):

```
Available Scenarios:

  sql-injection      Find SQL injection vectors in database queries
  xss                Detect cross-site scripting vulnerabilities
  auth-bypass        Find authentication and authorization flaws
  secrets-exposure   Detect hardcoded secrets and leaked credentials
  full-audit         Run all scenarios sequentially

Usage: redteam-arena battle <directory> --scenario <name>
```

---

### `redteam-arena --version`

Print version number.

### `redteam-arena --help`

Print help text (auto-generated by Commander).

## Agent Interface Contract

### `Agent` (interface)

```
analyze(context: AgentContext): AsyncIterable<string>
```

- **Input**: `AgentContext` containing scenario, codebase files, and conversation history
- **Output**: Async iterable of string chunks (streamed text)
- Implementations: `RedAgent`, `BlueAgent`

### `AgentContext`

| Field | Type | Description |
|-------|------|-------------|
| scenario | Scenario | The active scenario |
| files | FileEntry[] | Codebase files (path + content) |
| previousFindings | Finding[] | Findings from prior rounds |
| previousMitigations | Mitigation[] | Mitigations from prior rounds |
| roundNumber | number | Current round |
| role | "red" \| "blue" | Agent role |

### `FileEntry`

| Field | Type | Description |
|-------|------|-------------|
| path | string | Relative file path |
| content | string | File content (truncated to 64KB) |

### `Provider` (interface)

```
stream(messages: Message[], options: StreamOptions): AsyncIterable<string>
```

- **Input**: Array of chat messages + options (model, max_tokens, system prompt)
- **Output**: Async iterable of string chunks
- Implementations: `ClaudeAdapter`

### `StreamOptions`

| Field | Type | Description |
|-------|------|-------------|
| model | string | LLM model identifier |
| maxTokens | number | Maximum response tokens |
| systemPrompt | string | System-level instructions |

## Report Output Contract

### Battle Report (Markdown file)

**Filename**: `redteam-report-<battleId>.md`

**Sections**:
1. Header with title, date, scenario, target directory
2. Summary table: total rounds, findings by severity, mitigations proposed
3. Findings detail: one section per finding with severity, file, description, attack vector, mitigation
4. Raw battle log (collapsible): full agent output per round
